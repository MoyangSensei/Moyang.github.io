<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><meta name="author" content="Fy Jia"><meta name="renderer" content="webkit"><meta name="copyright" content="Fy Jia"><meta name="keywords" content="MoyangSensei"><meta name="description" content="null"><meta name="Cache-Control" content="no-cache"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>编译原理：词法分析程序 · MoYang</title><link rel="stylesheet" href="/css/style.css?v=2018.7.9"><link rel="stylesheet" href="/css/animation.css?v=2018.7.9"><link rel="icon" href="/img/assets/favicon.ico"><link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css?version=1.5.6"><!-- scripts--><script>(function( w ){
  "use strict";
  // rel=preload support test
  if( !w.loadCSS ){
    w.loadCSS = function(){};
  }
  // define on the loadCSS obj
  var rp = loadCSS.relpreload = {};
  // rel=preload feature support test
  // runs once and returns a function for compat purposes
  rp.support = (function(){
    var ret;
    try {
      ret = w.document.createElement( "link" ).relList.supports( "preload" );
    } catch (e) {
      ret = false;
    }
    return function(){
      return ret;
    };
  })();

  // if preload isn't supported, get an asynchronous load by using a non-matching media attribute
  // then change that media back to its intended value on load
  rp.bindMediaToggle = function( link ){
    // remember existing media attr for ultimate state, or default to 'all'
    var finalMedia = link.media || "all";

    function enableStylesheet(){
      link.media = finalMedia;
    }

    // bind load handlers to enable media
    if( link.addEventListener ){
      link.addEventListener( "load", enableStylesheet );
    } else if( link.attachEvent ){
      link.attachEvent( "onload", enableStylesheet );
    }

    // Set rel and non-applicable media type to start an async request
    // note: timeout allows this to happen async to let rendering continue in IE
    setTimeout(function(){
      link.rel = "stylesheet";
      link.media = "only x";
    });
    // also enable media after 3 seconds,
    // which will catch very old browsers (android 2.x, old firefox) that don't support onload on link
    setTimeout( enableStylesheet, 3000 );
  };

  // loop through link elements in DOM
  rp.poly = function(){
    // double check this to prevent external calls from running
    if( rp.support() ){
      return;
    }
    var links = w.document.getElementsByTagName( "link" );
    for( var i = 0; i < links.length; i++ ){
      var link = links[ i ];
      // qualify links to those with rel=preload and as=style attrs
      if( link.rel === "preload" && link.getAttribute( "as" ) === "style" && !link.getAttribute( "data-loadcss" ) ){
        // prevent rerunning on link
        link.setAttribute( "data-loadcss", true );
        // bind listeners to toggle media back
        rp.bindMediaToggle( link );
      }
    }
  };

  // if unsupported, run the polyfill
  if( !rp.support() ){
    // run once at least
    rp.poly();

    // rerun poly on an interval until onload
    var run = w.setInterval( rp.poly, 500 );
    if( w.addEventListener ){
      w.addEventListener( "load", function(){
        rp.poly();
        w.clearInterval( run );
      } );
    } else if( w.attachEvent ){
      w.attachEvent( "onload", function(){
        rp.poly();
        w.clearInterval( run );
      } );
    }
  }


  // commonjs
  if( typeof exports !== "undefined" ){
    exports.loadCSS = loadCSS;
  }
  else {
    w.loadCSS = loadCSS;
  }
}( typeof global !== "undefined" ? global : this ) );</script><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js" defer></script><script src="/js/main.js?v=2018.7.9" defer></script><!-- fancybox--><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" defer></script><!-- busuanzi--><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><meta name="generator" content="Hexo 5.1.1"><link rel="alternate" href="/atom.xml" title="MoyangSensei" type="application/atom+xml">
</head><body><section class="profile-close" id="cxo-profile"><div class="profile-avatar"><i class="fa fa-caret-left"></i><img src="/img/assets/cat.png"></div><!--.profile-saying
  i.fa.fa-comment
  .saying--><div class="cxo-profile-inner"><div class="profile-name">Fy J</div><div class="profile-signature">CS专业扫雷学深造学者互联网冲浪一级选手</div><div class="friends"><div>FRIENDS</div><span><a href="//hnjia00.github.io" target="_black">jhn</a></span></div><div class="read-progress"></div></div></section><header id="cxo-intro" style="height: 70vh;background-image: url(/img/intro/index-bg.png);"><nav id="cxo-intro-nav"><section><div class="intro-nav-title"><a href="/">MoYang's Blog</a></div><div class="intro-nav-label-box"><a href="/">Home</a><a href="/about/">About</a><a href="/archives/">Archives</a><a href="/tags/">Tags</a></div><i class="fa fa-bars intro-nav-menu"><div class="intro-nav-drop"><a href="/">Home</a><a href="/about/">About</a><a href="/archives/">Archives</a><a href="/tags/">Tags</a></div></i><div class="clear"></div></section></nav><h1 class="post-title">编译原理：词法分析程序</h1><div class="post-intros"><div class="post-intro-meta"><span class="post-intro-time"><i class="post-intro-calendar fa fa-calendar"></i><span>04-07-2019 21:33:19</span></span><span class="post-intro-tags"><a class="intro-tag fa fa-tag" href="javascript:void(0)" date-tags="编译原理"> 编译原理</a></span></div><div class="post-intro-read"><span> Word count: <span class="post-count">5.3k</span> | Reading time: <span class="post-count">22</span>min</span></div></div></header><article class="cxo-up" id="cxo-content-outer"><section id="cxo-content-inner"><article class="article-entry" id="post"><blockquote>
<p>原创文章，转载、引用请注明出处！</p>
</blockquote>
<blockquote>
<p>2019-05-20更新专题设计内容。</p>
</blockquote>
<h1 id="目标任务"><a href="#目标任务" class="headerlink" title="目标任务"></a>目标任务</h1><h2 id="要求"><a href="#要求" class="headerlink" title="要求"></a>要求</h2><p>以下为正则文法所描述的 C 语言子集单词符号的示例，请补充单词符号: ++，–， &gt;&gt;, &lt;&lt;, += , -= ,*=, /= ，&amp;&amp;(逻辑与)，||(逻辑或)，!(逻辑非)等等，给出补充后描述C语言子集单词符号的正则文法，设计并实现其词法分析程序。</p>
<p>&lt;标识符&gt;-&gt; 字母— &lt;标识符&gt;字母— &lt;标识符&gt;数字<br>&lt;无符号整数&gt;-&gt; 数字— &lt;无符号整数&gt;数字<br>&lt;单字符分界符&gt;-&gt; + – —* —;—, —(-) —{—}<br>&lt;双字符分界符&gt;-&gt; &lt;大于&gt;=—&lt;小于&gt;=—&lt;小于&gt;&gt;—&lt;感叹号&gt;=—&lt;等于&gt;=—&lt;斜竖&gt;*<br>&lt;小于&gt;-&gt; &lt;<br>&lt;等于&gt;-&gt; =<br>&lt;大于&gt;-&gt; &gt;<br>&lt;斜竖&gt;-&gt; /<br>&lt;感叹号&gt;-&gt; !</p>
<p>该语言的保留字 :void、int、float、double、if、else、for、do、while 等等(也可补充)。</p>
<h2 id="设计说明"><a href="#设计说明" class="headerlink" title="设计说明"></a>设计说明</h2><ul>
<li><p>(1)可将该语言设计成大小写不敏感，也可设计成大小写敏感，用户定 义的标识符最长不超过 32 个字符;</p>
</li>
<li><p>(2)字母为 a-z A-Z，数字为 0-9;</p>
</li>
<li><p>(3)可以对上述文法 进行扩充和改造;</p>
</li>
<li><p>(4)“/*……*/”和“//”(一行内)为程序的注释部分。</p>
</li>
</ul>
<h2 id="设计要求"><a href="#设计要求" class="headerlink" title="设计要求"></a>设计要求</h2><ul>
<li><p>(1)给出各单词符号的类别编码;</p>
</li>
<li><p>(2)词法分析程序应能发现输入串中的错误;</p>
</li>
<li><p>(3)词法分析作为单独一遍编写，词法分析结果为二元式序列组成的中间文件;</p>
</li>
<li><p>(4) 设计两个测试用例(尽可能完备)，并给出测试结果。</p>
</li>
</ul>
<hr>
<h1 id="解答"><a href="#解答" class="headerlink" title="解答"></a>解答</h1><h2 id="词法分析器"><a href="#词法分析器" class="headerlink" title="词法分析器"></a>词法分析器</h2><p>词法分析是编译程序进行编译时第一个要进行的任务，主要是对源程序进行编译预处理（去除注释、无用的回车换行找到包含的文件等）之后，对整个源程序进行分解，分解成一个个单词，这些单词大致可五类，分别是标识符、保留字、常数、运算符、界符。以便为下面的语法分析和语义分析做准备。</p>
<p>词法分析面向的对象是单个的字符，目的是把它们组成有效的单词（字符串）。另外，由于词法分析器在编译器中负责读取源程序，因此除了识别词素之外，它还会完成一些其他任务，比如过滤掉源程序中的注释和空白，将编译器生成的错误消息与源程序的位置关联起来等。</p>
<h2 id="设计思想"><a href="#设计思想" class="headerlink" title="设计思想"></a>设计思想</h2><p>根据对词法分析器的解释可知，一个词法分析器需要实现以下基本功能：</p>
<ul>
<li><p>（1）识别词素：将字符所组成的词正确分割且加以分类；</p>
</li>
<li><p>（2）错误指示：将编译器生成的错误消息与源程序的位置关联起来。</p>
</li>
</ul>
<p>而词法分析过程中有一些不必要的过程，这些过程虽然不是词法分析的核心思想，但是合理运用有助于更好的完成这一任务：</p>
<ul>
<li><p>（1）过滤源程序中的无用字符（注释和空白等）；</p>
</li>
<li><p>（2）词法分析一旦遇到错误不一定要直接停止，而是跳过错误部分继续后面的分析（一处错误并不一定导致其后的内容错误）。</p>
</li>
</ul>
<p>以结构化程序思想看待上述设计思想，就可以用这样的流程来实现词法分析器程序：</p>
<p><img src="/images/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/1/5.png" alt="图1" title="Optional title"></p>
<p>对于目标内容中的每一个字符都进行上述处理，然后按照处理顺序将词素识别出来，加以区分；将无法识别的词素认定为错误，定出位置即可。</p>
<p>明晰了程序流程之后，接下来的问题是：如何识别词素？换言之，什么样的词素在我们看来才是“正确”的？由于我们编写的是C语言字符集的词法分析程序，那么首先可以确定的是：符合c语言词法规则的词是我们需要加以识别的。</p>
<p>而C语言的词法规则是极其复杂的，即使我们所写的是简化版字符集，一样也有很多内容需要我们去完善，直接编写势必会使代码复杂度增加，且没有统一的代码规则规定我们的判断条件。</p>
<p>在学习过编译原理的文法之后，我们都知道，只有满足字符集文法规则的终结字符才可以被识别成为正确。</p>
<p>所以词法分析程序的更深层目标应该是完善我们要编写的字符集的规则，并把它转化成文法规则，以计算机代码表示。这样，针对特定字符时，我们的查找就有了方向。</p>
<h2 id="代码流程描述"><a href="#代码流程描述" class="headerlink" title="代码流程描述"></a>代码流程描述</h2><p>函数调用流程如下：</p>
<p><img src="/images/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/1/6.png" alt="图2" title="Optional title"></p>
<p>文件结构及函数简介如下：</p>
<p><img src="/images/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/1/7.png" alt="图3" title="Optional title"></p>
<h2 id="字符集及其规则描述"><a href="#字符集及其规则描述" class="headerlink" title="字符集及其规则描述"></a>字符集及其规则描述</h2><p>首先给出扩充后的字符集及其编码：</p>
<p><img src="/images/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/1/8.png" alt="图3" title="Optional title"></p>
<p>可将上述字符分为三类：标识符（保留字）及数字、单字符、双字符。对于不可衍生出双字符的单字符而言，只要检测到的单字符存在于上述定义表中即可匹配成功。而部分单字符的衍生字符和标识符（保留字）及数字的长度往往不止一个字符，那么就要对它们的词法规则作出规定，这样的规定既要符号现实的c语言词法规则，也要能被我们的代码结构（条件判断语句）所识别。</p>
<p>规则如下：</p>
<p>&lt;标识符&gt;→字母|&lt;标识符&gt;字母|&lt;标识符&gt;数字<br>&lt;无符号整数&gt;→数字|数字&lt;无符号整数&gt;<br>&lt;等号&gt;→==|=<br>&lt;叹号&gt;→!=|!<br>&lt;大于号&gt;→&gt;&gt;|&gt;=|&gt;<br>&lt;小于号&gt;→&lt;&lt;|&lt;=|&lt;<br>&lt;并&gt;→&amp;&amp;|&amp;<br>&lt;或&gt;→|| | |</p>
<p>与其他规则不同的是，需要对不符合上述规则的进行错误指出，因为仅有上述字符在进行组合是会出现“组合错误”，比如“&amp;|”，再比如“&gt;&lt;”等。</p>
<h2 id="代码分析"><a href="#代码分析" class="headerlink" title="代码分析"></a>代码分析</h2><p>代码中有几个重要的部分：文件读取后的过滤函数、判断字符的4个函数和指出错误的函数。</p>
<p>首先是过滤函数。在预处理阶段要进行源程序字符串的无用字符过滤，这里的无用字符指的是：各种各样的格式字符（\n，\t等）以及注释。对于格式字符，设置条件判断语句，遇到后直接跳过录入即可。这里需要注意的是，空格不可去除，因为有部分空格是作为词法的分割而不是格式的部分，去除会导致词法错误；对于注释而言，c语言的词法中有两种注释：//……和/*……*/，针对第一种，只要遇到，就跳过从注释符到下一个最近的换行符之间的所有内容；对于第二种，遇到/*后，就跳过从该符号到下一个最近的*/之间的所有内容。具体及注释内容如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//过滤内容中的注释和无用内容</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">filterResource</span><span class="params">(<span class="keyword">char</span> formerAllCode[], <span class="keyword">int</span> pAllCode)</span></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> tempALlCode[<span class="number">100000</span>];</span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= pAllCode; i++)&#123;</span><br><span class="line">        <span class="comment">//去除单行注释 //......</span></span><br><span class="line">        <span class="keyword">if</span> (formerAllCode[i]==<span class="string">&#x27;/&#x27;</span>&amp;&amp;formerAllCode[i+<span class="number">1</span>]==<span class="string">&#x27;/&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">while</span> (formerAllCode[i] != <span class="string">&#x27;\n&#x27;</span>)&#123;</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//去除多行注释 /*......*/</span></span><br><span class="line">        <span class="keyword">if</span> (formerAllCode[i] == <span class="string">&#x27;/&#x27;</span>&amp;&amp;formerAllCode[i + <span class="number">1</span>] == <span class="string">&#x27;*&#x27;</span>)&#123;</span><br><span class="line">            i+=<span class="number">2</span>;</span><br><span class="line">            <span class="keyword">while</span> (formerAllCode[i] != <span class="string">&#x27;*&#x27;</span> || formerAllCode[i + <span class="number">1</span>] != <span class="string">&#x27;/&#x27;</span>)&#123;</span><br><span class="line">                i++;</span><br><span class="line">                <span class="keyword">if</span> (formerAllCode[i] == <span class="string">&#x27;$&#x27;</span>)&#123;</span><br><span class="line">                    <span class="comment">//如果在文件结束的时候都没有匹配到*/，说明注释符号有误</span></span><br><span class="line">                    <span class="comment">//程序直接结束，提示用户检查文件内容</span></span><br><span class="line">                    <span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;FUNC ERROR(filterResource)&quot;</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">                    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            i+=<span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//去除无用格式字符</span></span><br><span class="line">        <span class="comment">//空格不可去除，有部分空格是作为词法的分割而不是格式的部分，去除会导致词法错误</span></span><br><span class="line">        <span class="keyword">if</span> (formerAllCode[i] != <span class="string">&#x27;\n&#x27;</span>&amp;&amp;formerAllCode[i] != <span class="string">&#x27;\t&#x27;</span>&amp;&amp;formerAllCode[i] != <span class="string">&#x27;\v&#x27;</span>&amp;&amp;formerAllCode[i] != <span class="string">&#x27;\r&#x27;</span>)&#123;</span><br><span class="line">            <span class="comment">//至此，剩下的内容为合法内容</span></span><br><span class="line">            tempALlCode[count++] = formerAllCode[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    tempALlCode[count] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    <span class="built_in">strcpy</span>(formerAllCode, tempALlCode);</span><br><span class="line">    LoadAfterFilterInfo();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接下来是判断字符是否正确的4个扫描函数。其中Sacnner函数按顺序调用其他的三个函数，判断顺序依次是：是否是标识符（保留字）和常数、是否是单字符、是否是双字符。</p>
<p>对于标识符（保留字）和常数的判断，需要注意的问题是如果一个字串被识别为标识符，它的第一位就不可以是数字，这种情况就是错误的：char a[123a456]。此处需要对这样的情况加以区分，因为如果不加以区分的话会有两种结果：一是将123a456看作一个标识符，另一是将123和456看作两个常数，a看作一个标识符。而对于我们来说，这两种看法在实际的c语言编程中都是错误的。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//标识符（保留字）和常数判断</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">scanner_CharOrDigt</span><span class="params">(<span class="keyword">int</span> &amp;count)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (IsChar(SourceProgram[pAllCode]))&#123;</span><br><span class="line">        <span class="comment">//首字符为字母</span></span><br><span class="line">        symbols[count++] = SourceProgram[pAllCode];</span><br><span class="line">        pAllCode+=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (IsChar(SourceProgram[pAllCode]) || IsDigit(SourceProgram[pAllCode]))&#123;</span><br><span class="line">            <span class="comment">//后跟字母或数字</span></span><br><span class="line">            symbols[count++] = SourceProgram[pAllCode];</span><br><span class="line">            pAllCode+=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        symbols[count] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">        <span class="comment">//判断是否是保留字</span></span><br><span class="line">        <span class="keyword">if</span> ((symbolsNumber=getSymbolNumber(typeTable, symbols)) == <span class="number">-1</span>)&#123;</span><br><span class="line">            symbolsNumber = <span class="number">100</span>;</span><br><span class="line">            ifSuccess=<span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (IsDigit(SourceProgram[pAllCode]))&#123;</span><br><span class="line">        <span class="comment">//首字符为数字</span></span><br><span class="line">        <span class="keyword">while</span> (IsDigit(SourceProgram[pAllCode]))&#123;</span><br><span class="line">            <span class="comment">//后跟数字</span></span><br><span class="line">            symbols[count++] = SourceProgram[pAllCode];</span><br><span class="line">            pAllCode+=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        symbols[count] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span>(!IsChar(SourceProgram[pAllCode]))&#123;</span><br><span class="line">            symbolsNumber = <span class="number">99</span>;</span><br><span class="line">            ifSuccess=<span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//如果在首字符为数字的情况下发现后有字母，整个标识符都会被判断是错误的</span></span><br><span class="line">            <span class="comment">//组合错误</span></span><br><span class="line">            combinationError(symbols);</span><br><span class="line">            <span class="comment">//跳过该行</span></span><br><span class="line">            JumpErrorLine();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对于单字符的判断很简单，仅需要一个条件语句即可。</p>
<p>对于双字符的判断要运用到超前分析，如果不是双字符但符合单字符的情况，就要将数组指针前移。</p>
<p>本程序将词法的错误分为两类：一是未知字符错误：出现了系统中没有定义的字符，最简单的例子就是在代码中输出提示信息含有中文字符，因为所有的中文字符是没有在上面的字符集里的，所以会报此错误；另一是组合错误，即字符之间的组合出现错误，上面的123a456就是一种组合错误，常见的组合错误还有&amp;|等。需要注意的是，并不是所有的字符组合都是有错误的，比如+-和-+，它们在判断的时候应该属于两个单字符，但是+和-都可以作为双字符的第一个字符。对于大多数的这种情况来说，应该是语法分析需要完成的内容，在本程序里，之需要对这种情况做单字符判断即可。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//输出未定义字符错误信息</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">undefinedError</span><span class="params">(<span class="keyword">char</span> ch)</span></span>&#123;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;----------------&quot;</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;[&quot;</span>&lt;&lt;ErrorCounter&lt;&lt;<span class="string">&quot;]&quot;</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    ErrorCounter+=<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;错误种类:未定义字符错误&quot;</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;错误语句-&gt;  &quot;</span>&lt;&lt;CodeOfEveryLine[pLineCounter]&lt;&lt;<span class="built_in">endl</span>&lt;&lt;<span class="string">&quot;错误位置-&gt;  &quot;</span>&lt;&lt;ch&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;----------------&quot;</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//输出组合错误信息</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">combinationError</span><span class="params">(<span class="keyword">char</span> *symbols)</span></span>&#123;</span><br><span class="line">    symbols[<span class="number">1</span>]=SourceProgram[pAllCode];</span><br><span class="line">    symbols[<span class="number">2</span>]=<span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    ifErrorLine=<span class="literal">true</span>;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;----------------&quot;</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;[&quot;</span>&lt;&lt;ErrorCounter&lt;&lt;<span class="string">&quot;]&quot;</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    ErrorCounter+=<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;错误种类:组合错误&quot;</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;错误语句-&gt;  &quot;</span>&lt;&lt;CodeOfEveryLine[pLineCounter]&lt;&lt;<span class="built_in">endl</span>&lt;&lt;<span class="string">&quot;错误位置-&gt;  &quot;</span>&lt;&lt;symbols&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;----------------&quot;</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="结果测试"><a href="#结果测试" class="headerlink" title="结果测试"></a>结果测试</h2><p>以两个错误信息输出函数为测试代码，将代码放入SourceProgram.txt中：</p>
<p><img src="/images/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/1/9.png" alt="图4" title="Optional title"></p>
<p>运行程序，发现该代码段无错误：</p>
<p><img src="/images/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/1/10.png" alt="图5" title="Optional title"></p>
<p>查看ResultofLexicalAnalysis.txt文件（二元组）：</p>
<p><img src="/images/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/1/11.png" alt="图6" title="Optional title"></p>
<p>修改代码，人为的添加几处错误：</p>
<p><img src="/images/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/1/12.png" alt="图7" title="Optional title"></p>
<p>代码运行结果如下：</p>
<p><img src="/images/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/1/13.png" alt="图8" title="Optional title"></p>
<p>上述测试证明了该程序可按设计本意顺利完成各项功能：对于添加的三处错误，第一处是组合错误，后两处是未定义字符错误（/346是UTF-8字符集，用三个字节表示一个汉字）。</p>
<hr>
<h1 id="原例题"><a href="#原例题" class="headerlink" title="原例题"></a>原例题</h1><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><ul>
<li>某操作系统下合法的文件名规则为:device:name.extention,其中第 一部分(device:)和第三部分(.extention)可缺省，若 device、name 和 extention，编程序完成文件名的识别。</li>
<li>编写程序完成以下“无符号数”的识别和计算：G[&lt;无符号数&gt;]: 右线性正则文法</li>
</ul>
<p>&lt;无符号数&gt; → d &lt;余留无符号数&gt; ∣. &lt;小数部分&gt; ∣d </p>
<p>&lt;余留无符号数&gt; → d &lt;余留无符号数&gt; ∣. &lt;十进小数&gt; ∣ E &lt;指数部分&gt; ∣ . ∣ d </p>
<p>&lt;十进小数&gt; → E&lt;指数部分&gt; ∣d &lt;十进小数&gt; ∣ d</p>
<p>&lt;小数部分&gt; → d &lt;十进小数&gt; ∣ d</p>
<p>&lt;指数部分&gt; → d &lt;余留指数部分&gt; ∣+ &lt;整指数&gt; ∣ - &lt;整指数&gt; ∣ d </p>
<p>&lt;整指数&gt; → d &lt;余留整指数&gt; ∣ d</p>
<p>&lt;余留整指数&gt; → d &lt;余留整指数&gt; ∣ d 其中 d:代表数字 0-9</p>
<h2 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h2><p>词法分析是编译程序进行编译时第一个要进行的任务，主要是对源程序进行编译预处理（去除注释、无用的回车换行找到包含的文件等）之后，对整个源程序进行分解，分解成一个个单词，这些单词有且只有五类，分别是标识符、保留字、常数、运算符、界符。以便为下面的语法分析和语义分析做准备。可以说词法分析面向的对象是单个的字符，目的是把它们组成有效的单词（字符串）；而语法的分析则是利用词法分析的结果作为输入来分析是否符合语法规则并且进行语法制导下的语义分析，最后产生四元组(中间代码)，进行优化（可有可无）之后最终生成目标代码。</p>
<p>对于我们来说，词法分析程序的逻辑是十分简单的：<strong>通过循环的方式按顺序逐个识别输入的字符，如果某一个字符没有错误，那就进入下一个字符的识别，一旦发现有错就直接跳出，报错即可。</strong></p>
<p>在此思想下，我们需要考虑的问题是：<strong>我们怎么“识别”当前字符到底是对的还是错的</strong>？</p>
<p>在学习过编译原理的文法之后，我们都知道，<strong>只有满足文法规则的终结字符才可以被识别</strong>（右线性正则文法）。那么我们又怎么把抽象的文法规则具像化到代码中去？</p>
<p>状态转换图可以帮我们解决这个问题。我们都知道，状态转换图可以更加高效的表示文法。文法或许不好用计算机代码直接解释，但是自动机所化成的状态转换图就可以利用我们在数据结构中所学习的<strong>图论</strong>的知识来转化，仅需要很简单的结构体就可以完成：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//存储状态转换图中点-&gt;边-&gt;点的结构</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> from, to, next;</span><br><span class="line">    <span class="keyword">char</span> value;</span><br><span class="line">&#125;edge[<span class="number">100</span>];</span><br></pre></td></tr></table></figure>

<p>有了存储结构之后，我们就要使用循环的方式对输入进来的字符串进行检查。从入口状态开始检查第一个终结字符，直到检查完成即可。每往下进行一个字符，对应着状态转换图中状态的转换；每个字符的转换都必须符合提前设置好的状态转换图。<strong>如果从当前字符无法转换到下一个字符且当前字符不是最后一个字符或者检查完成的最后一个状态不是终结状态，就判定整个字符串匹配失败</strong>。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">judge</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;请键入字符串(&quot;</span>&lt;&lt;end_sentence&lt;&lt;<span class="string">&quot;退出):\n&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span>(;;)&#123;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;\n[&quot;</span>&lt;&lt;round++&lt;&lt;<span class="string">&quot;]: &quot;</span>;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; print_sentence;</span><br><span class="line">        <span class="keyword">if</span>(print_sentence == end_sentence)&#123;</span><br><span class="line">            <span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;退出&quot;</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//当前状态标号</span></span><br><span class="line">        <span class="keyword">int</span> now=<span class="number">0</span>; </span><br><span class="line">        <span class="comment">//标记是否是合法的串</span></span><br><span class="line">        <span class="keyword">bool</span> flag=<span class="literal">true</span>; </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; print_sentence.length() &amp;&amp; flag; i++)&#123;</span><br><span class="line">            <span class="keyword">char</span> value = print_sentence[i];</span><br><span class="line">            <span class="keyword">if</span> (judge_VT(value))</span><br><span class="line">                value = vt_represent;</span><br><span class="line">            flag = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = node[now]; j != <span class="number">-1</span>; j = edge[j].next)</span><br><span class="line">                <span class="keyword">if</span> (edge[j].value == value)&#123;</span><br><span class="line">                    flag = <span class="literal">true</span>;</span><br><span class="line">                    now = edge[j].to;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!isFinal[now])&#123;</span><br><span class="line">            flag = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(flag)&#123;</span><br><span class="line">            <span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;正确&quot;</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;错误&quot;</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>上述过程中，我们需要函数来帮我们识别除了特殊符号外的终结符。识别过后的终结符直接更换为更一般的符号代替，简化代码流程：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//识别0-9</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">judge_VT</span><span class="params">(<span class="keyword">char</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (x &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; x &lt;= <span class="string">&#x27;9&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//识别所有字母</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">judge_VT</span><span class="params">(<span class="keyword">char</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ((x &gt;= <span class="string">&#x27;A&#x27;</span> &amp;&amp; x &lt;= <span class="string">&#x27;Z&#x27;</span>) || (x &gt;= <span class="string">&#x27;a&#x27;</span> &amp;&amp; x &lt;= <span class="string">&#x27;z&#x27;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="状态转换图"><a href="#状态转换图" class="headerlink" title="状态转换图"></a>状态转换图</h2><p>此思想下所需要的状态转换图<strong>没有必要是最简化的</strong>，由于输入的长度一定是有限的，转换图中拥有回路亦可得出答案。</p>
<p>例题1的状态转换图如下所示：</p>
<p><img src="/images/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/1/1.png" alt="例题1的状态转换图" title="Optional title"></p>
<p>转换为代码中的变量如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> node[<span class="number">6</span>];<span class="comment">//状态节点，0~5</span></span><br><span class="line"><span class="keyword">int</span> cnt;</span><br><span class="line"><span class="keyword">bool</span> isFinal[<span class="number">6</span>]; <span class="comment">//判断一个状态是不是终态</span></span><br><span class="line"><span class="keyword">int</span> counter=<span class="number">9</span>;</span><br><span class="line"><span class="keyword">int</span> vn_left[]=&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">5</span>&#125;;</span><br><span class="line"><span class="keyword">char</span> vt[]=&#123;vt_represent,vt_represent,<span class="string">&#x27;:&#x27;</span>,<span class="string">&#x27;.&#x27;</span>,vt_represent,vt_represent,<span class="string">&#x27;.&#x27;</span>,vt_represent,vt_represent,&#125;;</span><br><span class="line"><span class="keyword">int</span> vn_right[]=&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setFinal</span><span class="params">()</span></span>&#123;</span><br><span class="line">    isFinal[<span class="number">1</span>] = isFinal[<span class="number">4</span>] = isFinal[<span class="number">5</span>] = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>例题2的状态转换图如下所示：</p>
<p><img src="/images/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/1/2.png" alt="例题2的状态转换图" title="Optional title"></p>
<p>转换为代码中的变量如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> node[<span class="number">8</span>];<span class="comment">//状态节点，0~5</span></span><br><span class="line"><span class="keyword">int</span> cnt;</span><br><span class="line"><span class="keyword">bool</span> isFinal[<span class="number">8</span>]; <span class="comment">//判断一个状态是不是终态</span></span><br><span class="line"><span class="keyword">int</span> counter=<span class="number">17</span>;</span><br><span class="line"><span class="keyword">int</span> vn_left[]=&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">6</span>&#125;;</span><br><span class="line"><span class="keyword">char</span> vt[]=&#123;vt_represent,<span class="string">&#x27;.&#x27;</span>,<span class="string">&#x27;e&#x27;</span>, vt_represent,<span class="string">&#x27;.&#x27;</span>,<span class="string">&#x27;e&#x27;</span>,vt_represent,vt_represent,vt_represent,<span class="string">&#x27;e&#x27;</span>,vt_represent,<span class="string">&#x27;+&#x27;</span>,<span class="string">&#x27;-&#x27;</span>,vt_represent,vt_represent,vt_represent,vt_represent&#125;;</span><br><span class="line"><span class="keyword">int</span> vn_right[]=&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">7</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">7</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">6</span>,<span class="number">6</span>,<span class="number">7</span>&#125;;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setFinal</span><span class="params">()</span></span>&#123;</span><br><span class="line">    isFinal[<span class="number">1</span>] = isFinal[<span class="number">3</span>] = isFinal[<span class="number">6</span>] = isFinal[<span class="number">7</span>] = <span class="literal">true</span>;<span class="comment">//标记终态</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2><p>除了上述的部分代码不一样外，这两道例题的思想是一样的，它们公用下面的程序。执行不同的程序就将另外一个程序的变量注释（注释中以标出），直接编译运行即可。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//公共变量,用作提示信息和输入等</span></span><br><span class="line"><span class="keyword">int</span> round;</span><br><span class="line"><span class="built_in">string</span> print_sentence;</span><br><span class="line"><span class="built_in">string</span> end_sentence;</span><br><span class="line"><span class="keyword">char</span> vt_represent=<span class="string">&#x27;d&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> from, to, next;</span><br><span class="line">    <span class="keyword">char</span> value;</span><br><span class="line">&#125;edge[<span class="number">100</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//////////////////////////第九题的变量及函数</span></span><br><span class="line"><span class="comment">//int node[6];//状态节点，0~5</span></span><br><span class="line"><span class="comment">//int cnt;</span></span><br><span class="line"><span class="comment">//bool isFinal[6]; //判断一个状态是不是终态</span></span><br><span class="line"><span class="comment">//int counter=9;</span></span><br><span class="line"><span class="comment">//int vn_left[]=&#123;0,1,1,1,2,3,4,4,5&#125;;</span></span><br><span class="line"><span class="comment">//char vt[]=&#123;vt_represent,vt_represent,&#x27;:&#x27;,&#x27;.&#x27;,vt_represent,vt_represent,&#x27;.&#x27;,vt_represent,vt_represent,&#125;;</span></span><br><span class="line"><span class="comment">//int vn_right[]=&#123;1,1,2,3,4,5,3,4,5&#125;;</span></span><br><span class="line"><span class="comment">//bool judge_VT(char x)&#123;</span></span><br><span class="line"><span class="comment">//    return ((x &gt;= &#x27;A&#x27; &amp;&amp; x &lt;= &#x27;Z&#x27;) || (x &gt;= &#x27;a&#x27; &amp;&amp; x &lt;= &#x27;z&#x27;));</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="comment">//void setFinal()&#123;</span></span><br><span class="line"><span class="comment">//    isFinal[1] = isFinal[4] = isFinal[5] = true;</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//////////////////////////第十题的变量及函数</span></span><br><span class="line"><span class="keyword">int</span> node[<span class="number">8</span>];<span class="comment">//状态节点，0~5</span></span><br><span class="line"><span class="keyword">int</span> cnt;</span><br><span class="line"><span class="keyword">bool</span> isFinal[<span class="number">8</span>]; <span class="comment">//判断一个状态是不是终态</span></span><br><span class="line"><span class="keyword">int</span> counter=<span class="number">17</span>;</span><br><span class="line"><span class="keyword">int</span> vn_left[]=&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">6</span>&#125;;</span><br><span class="line"><span class="keyword">char</span> vt[]=&#123;vt_represent,<span class="string">&#x27;.&#x27;</span>,<span class="string">&#x27;e&#x27;</span>, vt_represent,<span class="string">&#x27;.&#x27;</span>,<span class="string">&#x27;e&#x27;</span>,vt_represent,vt_represent,vt_represent,<span class="string">&#x27;e&#x27;</span>,vt_represent,<span class="string">&#x27;+&#x27;</span>,<span class="string">&#x27;-&#x27;</span>,vt_represent,vt_represent,vt_represent,vt_represent&#125;;</span><br><span class="line"><span class="keyword">int</span> vn_right[]=&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">7</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">7</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">6</span>,<span class="number">6</span>,<span class="number">7</span>&#125;;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">judge_VT</span><span class="params">(<span class="keyword">char</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (x &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; x &lt;= <span class="string">&#x27;9&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setFinal</span><span class="params">()</span></span>&#123;</span><br><span class="line">    isFinal[<span class="number">1</span>] = isFinal[<span class="number">3</span>] = isFinal[<span class="number">6</span>] = isFinal[<span class="number">7</span>] = <span class="literal">true</span>;<span class="comment">//标记终态</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//////////////////////////公共函数</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//插入边的函数</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> from, <span class="keyword">int</span> to, <span class="keyword">char</span> value)</span></span>&#123;</span><br><span class="line">    edge[cnt].from = from;</span><br><span class="line">    edge[cnt].to = to;</span><br><span class="line">    edge[cnt].value = value;</span><br><span class="line">    edge[cnt].next = node[from];</span><br><span class="line">    node[from] = cnt++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//初始化函数，用来构造自动机的状态转换</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    end_sentence=<span class="string">&quot;end&quot;</span>;</span><br><span class="line">    round=<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">memset</span>(node, <span class="number">-1</span>, <span class="keyword">sizeof</span>(node));</span><br><span class="line">    <span class="built_in">memset</span>(isFinal, <span class="literal">false</span>, <span class="keyword">sizeof</span>(isFinal));</span><br><span class="line">    setFinal();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;counter;i++)&#123;</span><br><span class="line">        insert(vn_left[i], vn_right[i], vt[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">judge</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;请键入字符串(&quot;</span>&lt;&lt;end_sentence&lt;&lt;<span class="string">&quot;退出):\n&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span>(;;)&#123;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;\n[&quot;</span>&lt;&lt;round++&lt;&lt;<span class="string">&quot;]: &quot;</span>;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; print_sentence;</span><br><span class="line">        <span class="keyword">if</span>(print_sentence == end_sentence)&#123;</span><br><span class="line">            <span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;退出&quot;</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> now=<span class="number">0</span>; <span class="comment">//now 当前状态</span></span><br><span class="line">        <span class="keyword">bool</span> flag=<span class="literal">true</span>; <span class="comment">//标记是否是合法的串</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; print_sentence.length() &amp;&amp; flag; i++)&#123;</span><br><span class="line">            <span class="keyword">char</span> value = print_sentence[i];</span><br><span class="line">            <span class="keyword">if</span> (judge_VT(value))</span><br><span class="line">                value = vt_represent;</span><br><span class="line">            flag = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = node[now]; j != <span class="number">-1</span>; j = edge[j].next)</span><br><span class="line">                <span class="keyword">if</span> (edge[j].value == value)&#123;</span><br><span class="line">                    flag = <span class="literal">true</span>;</span><br><span class="line">                    now = edge[j].to;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!isFinal[now])&#123;</span><br><span class="line">            flag = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(flag)&#123;</span><br><span class="line">            <span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;正确&quot;</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;错误&quot;</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    init();</span><br><span class="line">    judge();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="运行结果"><a href="#运行结果" class="headerlink" title="运行结果"></a>运行结果</h2><p>例题1的运行结果：</p>
<p><img src="/images/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/1/3.png" alt="例题1的运行结果" title="Optional title"></p>
<p>例题2的运行结果：</p>
<p><img src="/images/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/1/4.png" alt="例题2的运行结果" title="Optional title"></p>
</article><!-- lincense--><div class="post-paginator"><a class="prevSlogan" href="/2019/04/21/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%EF%BC%9A%E9%80%92%E5%BD%92%E4%B8%8B%E9%99%8D%E5%88%86%E6%9E%90/" title="编译原理：递归下降分析"><span>< PreviousPost</span><br><span class="prevTitle">编译原理：递归下降分析</span></a><a class="nextSlogan" href="/2019/04/07/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%881%EF%BC%89-%E6%9D%A5%E5%8E%BB%E4%B9%8B%E8%B7%AF/" title="深度学习笔记（1）:来去之路"><span>NextPost ></span><br><span class="nextTitle">深度学习笔记（1）:来去之路</span></a><div class="clear"></div></div><div id="comment"></div></section></article><footer id="cxo-footer-outer"><div id="cxo-footer-inner"><p class="footer-container"><span>Site by </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span> | theme </span><a target="_blank" rel="noopener" href="https://github.com/Longlongyu/hexo-theme-Cxo"><span>Cxo</span></a></p><i class="fa fa-user"> </i><span id="busuanzi_value_site_uv"></span><span> | </span><i class="fa fa-eye"> </i><span id="busuanzi_value_site_pv"></span></div></footer><!-- catelog--><div class="toc-wrapper" style="top: 70vh;"><div class="toc-catalog"><i class="fa fa-list"> </i><span>CATALOG</span></div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%9B%AE%E6%A0%87%E4%BB%BB%E5%8A%A1"><span class="toc-number">1.</span> <span class="toc-text">目标任务</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A6%81%E6%B1%82"><span class="toc-number">1.1.</span> <span class="toc-text">要求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E8%AF%B4%E6%98%8E"><span class="toc-number">1.2.</span> <span class="toc-text">设计说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E8%A6%81%E6%B1%82"><span class="toc-number">1.3.</span> <span class="toc-text">设计要求</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A7%A3%E7%AD%94"><span class="toc-number">2.</span> <span class="toc-text">解答</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%8D%E6%B3%95%E5%88%86%E6%9E%90%E5%99%A8"><span class="toc-number">2.1.</span> <span class="toc-text">词法分析器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3"><span class="toc-number">2.2.</span> <span class="toc-text">设计思想</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%B5%81%E7%A8%8B%E6%8F%8F%E8%BF%B0"><span class="toc-number">2.3.</span> <span class="toc-text">代码流程描述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E9%9B%86%E5%8F%8A%E5%85%B6%E8%A7%84%E5%88%99%E6%8F%8F%E8%BF%B0"><span class="toc-number">2.4.</span> <span class="toc-text">字符集及其规则描述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-number">2.5.</span> <span class="toc-text">代码分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E6%9E%9C%E6%B5%8B%E8%AF%95"><span class="toc-number">2.6.</span> <span class="toc-text">结果测试</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8E%9F%E4%BE%8B%E9%A2%98"><span class="toc-number">3.</span> <span class="toc-text">原例题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE"><span class="toc-number">3.1.</span> <span class="toc-text">题目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF"><span class="toc-number">3.2.</span> <span class="toc-text">解题思路</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E8%BD%AC%E6%8D%A2%E5%9B%BE"><span class="toc-number">3.3.</span> <span class="toc-text">状态转换图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81"><span class="toc-number">3.4.</span> <span class="toc-text">完整代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C"><span class="toc-number">3.5.</span> <span class="toc-text">运行结果</span></a></li></ol></li></ol></div><!-- top--><i class="fa fa-arrow-up close" id="go-up" aria-hidden="true"></i></body></html>